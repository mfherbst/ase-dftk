language: python
cache:
  directories:
    - "$HOME/.cache/pip"
    - "$HOME/.julia/artifacts"

notifications:
  email: false

branches:
  only:
    # Only build master and version tags
    - master
    - /^v\d+\.\d+(\.\d+)?(-\S*)?$/

env:
  global:
    - JULIA_NUM_THREADS=2

install:
  # Code dependencies:
  - bash .ci/get_julia.sh
  - travis_retry pip3 install -r requirements.txt
  - python3 -c "import asedftk; asedftk.install()"
  # Test dependencies:
  - pip3 install pytest
  - julia -e 'import Pkg; Pkg.add("Test")'

script:
  - julia -e 'include("asedftk/test_asedftk.jl")'
  - python-jl -m pytest

jobs:
  include:
    - stage: test
      env: BUILD_SDIST=true
      python: 3.6
    - os: osx
      language: ruby

deploy:  # Note: This will only deploy sdist on linux!
  skip_cleanup: true
  provider: pypi
  user: "__token__"
  password:
    secure: "R3vx6HnPqFCrUp19Mm1Y6LLFexiRDXeKtcv8YbFHXVnxYvXktJbXBSTdaFk1qKE7JaJ0uiMREUQqccQm1WEBLCZRSz0lB5i96dl+l/q+9+wkXatm8CRtl3Vl9A8Jrg+PSALfy1I77X1Y7pW2zXBfQY8YZOmuF4nwTXgJoTXEQGxYFlmpv+nl2fYM+w1UmqIDBLAuTLP7mev9FnUS/5JBsATj0Hn+qIgjiT+hxt09MPL7exVF2YQu+S4msmN/gSgisYUBkscJwzcjaeN5y8h2gXnoWYT9y/S5/M+Nlo1ewVdzY7CC1pb2ydLnpktrA06RYNSuYZNNS6Qq7c6TPzetkj2F03oS4/HfphMztYhFFN5ruAVwGDLFfYod0IVRRFBycsikmTAYk1eW/oyum/Dt0/9d8RlLy2RdqS4IyKkveytrC8wv6eZM3vpPpJUUEcMiWkf1hOZPm0l6aF34sHT3OgOuK7OHcgLvptv7nN4k4cPCJadBcQoFMqgii0kYOPGBLlRvkwb5OqLfnC6P+9xMVSe/Lh0jTCITkREWikyUJdhGBeb7OFLnlSpwQ5C8xMKTYBd0hnmBndoxL4LgvY1jaBEyprIWkEhbu6fT4xITkDUa2nd7lf31RUSlvk7Wx6lHWTMFnS8Di+ockZgx4ltaaSYzO5Amfp/WP/dAM4Cee+A="
  on:
    tags: true
    all_branches: true
    condition: "$BUILD_SDIST == true"
